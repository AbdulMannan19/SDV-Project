<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Electronics Sales & Marketing Impact</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
    <div class="header">
        <h1>Global Electronics Sales & Marketing Impact</h1>
        <p>Analyzing ROI and Regional Performance</p>
    </div>

    <div class="nav">
        <a href="/" class="active">Dashboard</a>
        <a href="/roi-analysis">ROI Deep Dive</a>
        <a href="/product-performance">Product Performance</a>
    </div>

    <div class="container">
        <div class="cards" id="summary-cards">
            <div class="card">
                <h3>Total Revenue</h3>
                <div class="value" id="total-revenue">Loading...</div>
                <div class="label">From campaign-driven sales</div>
            </div>
            <div class="card">
                <h3>Marketing Spend</h3>
                <div class="value" id="total-spend">Loading...</div>
                <div class="label">Total investment</div>
            </div>
            <div class="card">
                <h3>Overall ROI</h3>
                <div class="value" id="overall-roi">Loading...</div>
                <div class="label">Return on investment</div>
            </div>
            <div class="card">
                <h3>Best Campaign Type</h3>
                <div class="value" id="best-campaign">Loading...</div>
                <div class="label" id="best-campaign-roi">ROI: --</div>
            </div>
        </div>

        <div class="section">
            <h2>Regional ROI Overview</h2>
            <div class="viz-container" id="region-chart">
                <p class="loading">Loading visualization</p>
            </div>
        </div>

        <div class="section">
            <h2>Campaign Type Performance</h2>
            <div class="viz-container" id="campaign-chart">
                <p class="loading">Loading visualization</p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>CSCE 5320 Scientific Data Visualization - Project 2</p>
    </div>

    <script>
        console.log('Loading dashboard...');

        // Load summary data
        fetch('/api/summary')
            .then(res => {
                console.log('Summary response:', res.status);
                return res.json();
            })
            .then(data => {
                console.log('Summary data:', data);
                document.getElementById('total-revenue').textContent = '$' + data.total_revenue.toLocaleString('en-US', { maximumFractionDigits: 0 });
                document.getElementById('total-spend').textContent = '$' + data.total_marketing_spend.toLocaleString('en-US', { maximumFractionDigits: 0 });

                const roiElement = document.getElementById('overall-roi');
                roiElement.textContent = data.overall_roi.toFixed(1) + '%';
                roiElement.parentElement.classList.add(data.overall_roi >= 0 ? 'positive' : 'negative');

                document.getElementById('best-campaign').textContent = data.best_campaign_type;
                document.getElementById('best-campaign-roi').textContent = 'ROI: ' + data.best_campaign_roi.toFixed(1) + '%';
            })
            .catch(err => {
                console.error('Error loading summary:', err);
                document.querySelectorAll('.value').forEach(el => el.textContent = 'Error');
            });

        // Load region chart
        fetch('/api/viz/region-altair')
            .then(res => {
                console.log('Region chart response:', res.status);
                return res.text();
            })
            .then(html => {
                console.log('Region chart HTML length:', html.length);
                const container = document.getElementById('region-chart');
                container.innerHTML = html;

                // Extract and execute scripts (innerHTML doesn't auto-execute scripts)
                const scripts = container.getElementsByTagName('script');
                for (let script of scripts) {
                    const newScript = document.createElement('script');
                    newScript.type = 'text/javascript';
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                }
            })
            .catch(err => {
                console.error('Error loading region chart:', err);
                document.getElementById('region-chart').innerHTML = '<p class="loading">Failed to load chart</p>';
            });

        // Load campaign chart
        fetch('/api/viz/campaign-bar')
            .then(res => {
                console.log('Campaign chart response:', res.status);
                return res.text();
            })
            .then(html => {
                console.log('Campaign chart HTML length:', html.length);
                const container = document.getElementById('campaign-chart');
                container.innerHTML = html;

                // Extract and execute scripts (innerHTML doesn't auto-execute scripts)
                const scripts = container.getElementsByTagName('script');
                for (let script of scripts) {
                    const newScript = document.createElement('script');
                    newScript.type = 'text/javascript';
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                }
            })
            .catch(err => {
                console.error('Error loading campaign chart:', err);
                document.getElementById('campaign-chart').innerHTML = '<p class="loading">Failed to load chart</p>';
            });
    </script>
</body>

</html>